<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>PayPal NVP Activity Viewer</title>
    <style>
      body { font-family: system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, sans-serif; margin: 2rem; }
      header { margin-bottom: 1.5rem; }
      form { display: grid; grid-template-columns: repeat(4, minmax(200px, 1fr)); gap: 0.75rem; margin-bottom: 1rem; align-items: end; }
      label { display: block; font-weight: 600; margin-bottom: 0.25rem; }
      input[type="date"], input[type="text"] { width: 100%; padding: 0.5rem; border: 1px solid #ccc; border-radius: 6px; }
      button { padding: 0.6rem 1rem; background: #0366d6; color: white; border: none; border-radius: 6px; cursor: pointer; }
      button:disabled { opacity: 0.6; cursor: not-allowed; }
      .note { color: #666; font-size: 0.9rem; }
      .error { background: #fee; color: #900; padding: 0.75rem 1rem; border: 1px solid #f99; border-radius: 6px; margin-bottom: 1rem; }
      table { border-collapse: collapse; width: 100%; }
      th, td { border: 1px solid #e5e7eb; padding: 0.5rem 0.6rem; text-align: left; }
      th { background: #f9fafb; }
      tbody tr:nth-child(even) { background: #fafafa; }
      .muted { color: #6b7280; }
    </style>
  </head>
  <body>
    <header>
      <h1>PayPal Account Activity</h1>
      {% if not has_creds %}
        <p class="error">Missing PayPal API credentials. Add them to a .env file as shown in README.</p>
      {% else %}
        <p class="note">Enter a date range to search recent transactions. Times are interpreted as UTC.</p>
      {% endif %}
    </header>

    <form action="/search" method="post">
      <div>
        <label for="start_date">Start date</label>
        <input id="start_date" name="start_date" type="date" required>
      </div>
      <div>
        <label for="end_date">End date</label>
        <input id="end_date" name="end_date" type="date" required>
      </div>
      <div>
        <label for="email">Payer email (optional)</label>
        <input id="email" name="email" type="text" placeholder="payer@example.com">
      </div>
      <div>
        <label for="transaction_id">Transaction ID (optional)</label>
        <input id="transaction_id" name="transaction_id" type="text" placeholder="XXXXXXXXXXXX">
      </div>
      <div>
        <button type="submit" {% if not has_creds %}disabled{% endif %}>Search</button>
      </div>
    </form>

    {% if error %}
      <div class="error">{{ error }}</div>
    {% endif %}

    {% if transactions and transactions|length > 0 %}
      <table>
        <thead>
          <tr>
            <th>Timestamp</th>
            <th>Type</th>
            <th>Email</th>
            <th>Name</th>
            <th>Transaction ID</th>
            <th>Status</th>
            <th>Amount</th>
            <th>Currency</th>
            <th>Fee</th>
            <th>Net</th>
          </tr>
        </thead>
        <tbody>
          {% for tx in transactions %}
            <tr>
              <td class="muted">{{ tx.timestamp }}</td>
              <td>{{ tx.type }}</td>
              <td>{{ tx.email }}</td>
              <td>{{ tx.name }}</td>
              <td>{{ tx.transaction_id }}</td>
              <td>{{ tx.status }}</td>
              <td>{{ tx.amount }}</td>
              <td>{{ tx.currency }}</td>
              <td class="muted">{{ tx.fee }}</td>
              <td class="muted">{{ tx.net }}</td>
            </tr>
          {% endfor %}
        </tbody>
      </table>
    {% elif has_creds %}
      <p class="muted">No results yet. Submit the form to search.</p>
    {% endif %}
  </body>
</html>